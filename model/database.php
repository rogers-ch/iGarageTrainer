<?php

/*

INSERT INTO igarage_user
VALUES (NULL, 'Admin', 'Admin', 'Admin', '@dm1n', 'advanced')

 */

$home = str_replace("public_html", "", $_SERVER['DOCUMENT_ROOT']);

require_once $home . "config.php";

class Database
{

    private $_dbh;

    function __construct()
    {

        //Connect to database with PDO
        try {

            //Instantiate a database object
            $this->_dbh = new PDO(DB_DSN, DB_USERNAME, DB_PASSWORD);
            //echo 'Connected to database!';

        } catch (PDOException $e) {
            echo $e->getMessage();
        }

    }


    function writeUser($user)
    {
        //var_dump($user);


        //Write to database
        //1. Define the query
        $sql = "INSERT INTO igarage_user (user_id, firstName, lastName, username, password, fitness_level)
                VALUES (:user_id, :firstName, :lastName, :username, :password, :fitness_level)";

        //2. Prepare the statement
        $statement = $this->_dbh->prepare($sql);

        //3. Bind the parameters

        $null = NULL;

        $statement->bindParam(':user_id', $null);
        $statement->bindParam(':firstName', $user->getFName());
        $statement->bindParam(':lastName', $user->getLName());
        $statement->bindParam(':username', $user->getUserName());
        $statement->bindParam(':password', $user->getPassword());

        if(get_class($user) == 'PremiumUser') {

            $statement->bindParam(':fitness_level', $user->getFitnessLevel());

        } else {

            $statement->bindParam(':fitness_level', $null);

        }

        //4. Execute the statement
        $statement->execute();

        //5. Process the results (get the primary key generated by the insert statement)
        $sql = "SELECT LAST_INSERT_ID()";
        $statement = $this->_dbh->prepare($sql);
        $statement->execute();
        $result = $statement->fetch(PDO::FETCH_ASSOC);

        //set the user's UserNum to the user_id from the database
        $user->setUserNum($result['LAST_INSERT_ID()']);

        //Write the user's equipment to the database if this is a premium user - FIX THIS
        if(get_class($user) == 'PremiumUser') {
            /*
            //1. Define the query
            $sql = "INSERT INTO igarage_user (user_id, firstName, lastName, username, password, fitness_level)
                VALUES (:user_id, :firstName, :lastName, :username, :password, :fitness_level)";

            //2. Prepare the statement
            $statement = $this->_dbh->prepare($sql);

            //3. Bind the parameters

            $null = NULL;

            $statement->bindParam(':user_id', $null);
            $statement->bindParam(':firstName', $user->getFName());
            $statement->bindParam(':lastName', $user->getLName());
            $statement->bindParam(':username', $user->getUserName());
            $statement->bindParam(':password', $user->getPassword());

            if(get_class($user) == 'PremiumUser') {

                $statement->bindParam(':fitness_level', $user->getFitnessLevel());

            } else {

                $statement->bindParam(':fitness_level', $null);

            }

            //4. Execute the statement
            $statement->execute();


            */
        }


    }



}
